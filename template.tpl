___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "categories": ["ANALYTICS", "CONVERSIONS", "SALES"],
  "displayName": "Moesif API Analytics",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Track your activation funnel across both your websites and APIs with Moesif API Analytics. This tag also captures device context like geo location, browser version, UTM param, etc.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "applicationId",
    "displayName": "Moesif Application Id",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "actionName",
    "displayName": "Action Name",
    "simpleValueType": true,
    "defaultValue": "Page View"
  },
  {
    "type": "PARAM_TABLE",
    "name": "metadata",
    "displayName": "Event Metadata",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "name",
          "displayName": "Property Name",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "Property Value",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const callInWindow = require('callInWindow');
const queryPermission = require('queryPermission');

const scriptUrl = 'https://unpkg.com/moesif-browser-js@v1/moesif.min.js';

const applicationId = data.applicationId;
const actionName = data.actionName;
const metadata = data.metadata;
const eventProperties = {};
if (metadata && metadata.length > 0) {
  metadata.forEach((row) => {
    eventProperties[row.name] = row.value;
  });
}

log('data =', data);

const initMoesif = () => {
  const _moesif = copyFromWindow('_moesif');
  if (_moesif && _moesif.initialized) {
    log('Moesif already initialized');
    return;
  }
  const result = callInWindow('moesif.init', {
    applicationId: applicationId
  });
  log(result);
  setInWindow('_moesif', { initialized: true }, true);
};

const onSuccess = () => {
  log('Moesif script loaded successfully.');
  initMoesif();
  callInWindow('moesif.track', actionName, eventProperties);
  data.gtmOnSuccess();
};

const onFailure = () => {
  log('Moesif script load failed.');
  data.gtmOnFailure();
};

if (queryPermission('inject_script', scriptUrl)) {
  log('Injecting Moesif script.');
  injectScript(scriptUrl, onSuccess, onFailure, scriptUrl);
} else {
  log('Moesif script load failed due to permissions mismatch.');
  onFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moesif"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_moesif"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moesif.init"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moesif.track"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moesif.identifyUser"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moesif.identifyCompany"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://unpkg.com/moesif-browser-js*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/10/2020, 3:32:08 PM


